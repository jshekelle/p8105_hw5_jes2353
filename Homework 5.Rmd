---
title: "Homework 5"
author: "Jeanette Shekelle"
date: "11/5/2018"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(purrr)
library(ggplot2)
library(viridis)

set.seed(1234)
```



### Problem 1


Bringing in data from desktop folder data_problem_1

```{r}
files_path = list.files(path = "./data_problem_1", full.names = TRUE) 
remove_path = basename(list_path)
  
files_function = 
  function(data, name){
  list(read_csv(data) %>% 
  mutate(id = name))
}
path_names = 
  map2(files_path, remove_path, files_function)
problem_1 = 
  map_df(path_names, bind_rows)

```

```{r}
list_path = list.files(path = "./data_problem_1", full.names = TRUE) 
remove_path = basename(list_path)
  
files_function = 
  function(data, name){
  list(read_csv(data) %>% 
  mutate(id = name))
}
path_names = 
  map2(list_path, remove_path, files_function)
problem_1_df = 
  map_df(path_names, bind_rows)
```



Tidy the result; manipulate file names to include control arm and subject ID
* Make columns variables and rows observations

```{r}
problem_1_df_clean = 
problem_1_df %>% 
  gather(key = "week", value = "value", week_1:week_8) %>% 
  separate(id, into = c("arm","id"), sep = "_") %>% 
  mutate(id = str_replace(id, ".csv", ""),
         arm = str_replace(arm, "con", "control"), 
         arm = str_replace(arm, "exp", "experimental")) 
```


### Problem 2

```{r}
homicide_data = read_csv(file = "./data_problem_2/homicide_data.csv")
```

The raw data contains 52,179 observations and 12 variables. Each observation is a homicide. Important variables are the city and state where it occured and the disposition (arrest made, case still open, closed without arrest, etc.). The dataset also contains the victims first and last name, sex, age, and the exact location of the homicide (longitude and latitude). 



Looking at total homicides by city and state: 

```{r}
  homicide_data %>% 
  mutate(city_state = paste(city, state, sep = ',')) %>% 
  group_by(city_state) %>% 
  summarise(total_homicides = n()) %>% 
  knitr::kable()
```


Looking at total unsolved homicides:

```{r}
homicide_data %>% 
  filter(str_detect(disposition, "open | without")) %>% 
  mutate(city_state = paste(city, state, sep = ',')) %>% 
  group_by(city_state) %>% 
  summarise(total_unsolved = n()) %>% 
  knitr::kable()
```


Proportion of unsolved homicides in Baltimore

```{r}
baltimore_unsolved = 
  homicide_data %>% 
  filter(city == "Baltimore") %>% 
  filter(str_detect(disposition, "open | without")) %>% 
  summarise(total_unsolved = n())
```

```{r}
baltimore_total = 
  homicide_data %>% 
  filter(city == "Baltimore") %>% 
  summarise(total_homicides = n())
```

```{r}
baltimore_prop = prop.test(baltimore_unsolved, baltimore_total)
```

